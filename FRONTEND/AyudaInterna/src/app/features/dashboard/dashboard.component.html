<div class="dashboard-header flex-column gap-3">
    <div class="filter-row w-100 flex align-center gap-2">
        <input type="text" [(ngModel)]="filterTitulo" (input)="loadSolicitudes()" placeholder="Buscar por título..."
            class="form-control flex-1">

        <select [(ngModel)]="filterEstado" (change)="loadSolicitudes()" class="filter-select">
            <option value="">Todos los Estados</option>
            <option *ngFor="let s of Estado | keyvalue" [value]="s.value">{{s.key}}</option>
        </select>

        <select [(ngModel)]="filterPrioridad" (change)="loadSolicitudes()" class="filter-select">
            <option value="">Todas las Prioridades</option>
            <option *ngFor="let p of Prioridad | keyvalue" [value]="p.value">{{p.key}}</option>
        </select>
    </div>

    <div class="filter-row w-100 flex align-center gap-2">
        <div class="flex-1 flex align-center gap-2">
            <label class="text-xs text-muted">Desde:</label>
            <input type="date" [(ngModel)]="filterFechaInicio" (change)="loadSolicitudes()" class="form-control">
        </div>
        <div class="flex-1 flex align-center gap-2">
            <label class="text-xs text-muted">Hasta:</label>
            <input type="date" [(ngModel)]="filterFechaFin" (change)="loadSolicitudes()" class="form-control">
        </div>
        <button
            (click)="filterTitulo=''; filterEstado=''; filterPrioridad=''; filterFechaInicio=''; filterFechaFin=''; loadSolicitudes()"
            class="btn btn-secondary btn-sm">Limpiar Filtros</button>
    </div>
</div>

<div *ngIf="loading()" class="flex justify-center py-10">
    <div class="spinner"></div>
</div>

<div *ngIf="error()" class="alert alert-danger mx-10 mb-4">
    {{ error() }}
</div>

<div class="card bg-surface shadow-md" *ngIf="!loading()">
    <div class="table-responsive">
        <table class="table">
            <thead>
                <tr>
                    <th>Título</th>
                    <th *ngIf="isOperator()">Usuario</th>
                    <th>Prioridad</th>
                    <th>Estado</th>
                    <th>Creación</th>
                    <th *ngIf="isOperator()">Actualización</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let solicitud of solicitudes()">
                    <td>
                        <a [routerLink]="['/request/view', solicitud.id]" class="font-semibold text-primary">
                            {{ solicitud.titulo }}
                        </a>
                    </td>
                    <td *ngIf="isOperator()">
                        <span class="text-sm">{{ solicitud.solicitanteUsername }}</span>
                    </td>
                    <td>
                        <span class="badge" [ngClass]="'badge-' + solicitud.prioridad.toLowerCase()">
                            {{ solicitud.prioridad }}
                        </span>
                    </td>
                    <td>
                        <span class="badge" [ngClass]="getStatusClass(solicitud.estado)">
                            {{ solicitud.estado }}
                        </span>
                    </td>
                    <td>{{ solicitud.fechaCreacion | date:'dd/MM/yy HH:mm' }}</td>
                    <td *ngIf="isOperator()">
                        {{ solicitud.fechaActualizacion | date:'dd/MM/yy HH:mm' }}
                    </td>
                    <td>
                        <div class="flex gap-1">
                            <button class="btn btn-sm btn-outline-primary"
                                [routerLink]="['/request/view', solicitud.id]">Ver</button>
                            <button class="btn btn-sm btn-outline-primary"
                                [routerLink]="['/request/edit', solicitud.id]">Editar</button>
                            <button class="btn btn-sm btn-outline-danger"
                                (click)="deleteSolicitud(solicitud.id!)">Borrar</button>
                        </div>
                    </td>
                </tr>
                <tr *ngIf="solicitudes().length === 0 && !loading()">
                    <td [attr.colspan]="isOperator() ? 7 : 5" style="text-align: center;">
                        No se encontraron solicitudes.
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>